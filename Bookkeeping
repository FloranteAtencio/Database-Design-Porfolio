ChartTypes(
    ChartTypesid INT PK,
    Account Varchar(100),
    Types Varchar(100)
)

TransactionHeader (
   TransactionHeaderid INT PK,
   Date date,
   Description Text
)

JournalLines(
   JournalLinesid INT PK,
   ChartTypesid INT FK,
   TransactionHeaderid INT FK,
   Journal Bit,
   Amount Decimal(12,2)
)

Customer (
    CustomerID INT PK,
    Name VARCHAR(150),
    Address VARCHAR(255),
    Contact VARCHAR(100),
    Email VARCHAR(100)
)

Vendor (
    VendorID INT PK,
    Name VARCHAR(150),
    Address VARCHAR(255),
    Contact VARCHAR(100),
    Email VARCHAR(100)
)

InvoiceAR (
    InvoiceID INT PK,
    CustomerID INT FK REFERENCES Customer(CustomerID),
    TransactionHeaderid INT FK REFERENCES TransactionHeader(TransactionHeaderid),
    InvoiceDate DATE,
    DueDate DATE,
    Status VARCHAR(50) -- (Pending, Paid, Overdue)
)

BillAP (
    BillID INT PK,
    VendorID INT FK REFERENCES Vendor(VendorID),
    TransactionHeaderid INT FK REFERENCES TransactionHeader(TransactionHeaderid),
    BillDate DATE,
    DueDate DATE,
    Status VARCHAR(50) -- (Pending, Paid, Overdue)
)

Product (
    ProductID INT PK,
    Name VARCHAR(150),
    Description VARCHAR(255),
    Unit VARCHAR(50), -- e.g., pcs, kg, box
    Cost DECIMAL(12,2),
    Price DECIMAL(12,2)
)

Warehouse (
    WarehouseID INT PK,
    Name VARCHAR(100),
    Location VARCHAR(255)
)

InventoryMovement (
    MovementID INT PK,
    ProductID INT FK REFERENCES Product(ProductID),
    WarehouseID INT FK REFERENCES Warehouse(WarehouseID),
    TransactionHeaderid INT FK REFERENCES Transaction(TransactionHeaderid),
    MovementType VARCHAR(20), -- (Purchase, Sale, Adjustment)
    Quantity DECIMAL(12,2),
    MovementDate DATE
)

--General Journal

SELECT 
    t.TransactionHeaderid,
    t.Date,
    t.Description,
    c.Account,
    CASE WHEN d.Journal = 1 THEN d.amount ELSE 0 END AS Debit,
    CASE WHEN d.Journal = 0 THEN d.amount ELSE 0 END AS Credit
FROM TransactionHeader t
JOIN JournalLines d ON t.TransactionHeaderid = d.TransactionHeaderid
JOIN ChartTypes c ON d.ChartTypesid = c.ChartTypesid
ORDER BY t.Date, t.TransactionHeaderid, d.JournalLinesid;

--General Ledger

SELECT 
    c.Account,
    t.Date,
    t.Description,
    CASE WHEN d.Journal = 1 THEN d.amount ELSE 0 END AS Debit,
    CASE WHEN d.Journal = 0 THEN d.amount ELSE 0 END AS Credit
FROM ChartTypes c
JOIN JournalLines d ON c.ChartTypesid = d.ChartTypesid
JOIN TransactionHeader t ON d.TransactionHeaderid = t.TransactionHeaderid
ORDER BY c.Account, t.Date, t.TransactionHeaderid;

----Trial Balance
SELECT 
    c.Account,
    c.Types,
    SUM(CASE WHEN d.Journal = 1 THEN d.amount ELSE 0 END) AS TotalDebit,
    SUM(CASE WHEN d.Journal = 0 THEN d.amount ELSE 0 END) AS TotalCredit
FROM ChartTypes c
JOIN JournalLines d ON c.ChartTypesid = d.ChartTypesid
GROUP BY c.Account, c.Types
ORDER BY c.Types, c.Account;

---Income Statement

SELECT 
    c.Types,
    c.Account,
    SUM(CASE WHEN d.Journal = 1 THEN d.amount ELSE 0 END) -
    SUM(CASE WHEN d.Journal = 0 THEN d.amount ELSE 0 END) AS NetAmount
FROM ChartTypes c
JOIN JournalLines d ON c.ChartTypesid = d.ChartTypesid
WHERE c.Types IN ('Revenue','Expense')
GROUP BY c.Types, c.Account
ORDER BY c.Types, c.Account;

--Balance Sheet

SELECT 
    c.Types,
    c.Account,
    SUM(CASE WHEN d.Journal = 1 THEN d.amount ELSE 0 END) -
    SUM(CASE WHEN d.Journal = 0 THEN d.amount ELSE 0 END) AS Balance
FROM ChartTypes c
JOIN JournalLines d ON c.ChartTypesid = d.ChartTypesid
WHERE c.Types IN ('Asset','Liability','Equity')
GROUP BY c.Types, c.Account
ORDER BY c.Types, c.Account;

---Current Stock Levels

SELECT 
    p.Name AS Product,
    SUM(CASE WHEN im.MovementType = 'Purchase' THEN im.Quantity
             WHEN im.MovementType = 'Sale' THEN -im.Quantity
             WHEN im.MovementType = 'Adjustment' THEN im.Quantity
             ELSE 0 END) AS CurrentStock
FROM Product p
JOIN InventoryMovement im ON p.ProductID = im.ProductID
GROUP BY p.Name;
---Inventory Valuation (at cost)
SELECT 
    p.Name AS Product,
    SUM(CASE WHEN im.MovementType = 'Purchase' THEN im.Quantity
             WHEN im.MovementType = 'Sale' THEN -im.Quantity
             WHEN im.MovementType = 'Adjustment' THEN im.Quantity
             ELSE 0 END) * p.Cost AS InventoryValue
FROM Product p
JOIN InventoryMovement im ON p.ProductID = im.ProductID
GROUP BY p.Name, p.Cost;
